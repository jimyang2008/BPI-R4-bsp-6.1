// SPDX-License-Identifier: (GPL-2.0 OR MIT)
/*
 * Copyright (C) 2022 MediaTek Inc.
 * Author: Sam.Shih <sam.shih@mediatek.com>
 */

#include "mt7988a-bananapi-bpi-r4.dtsi"
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>
#include <dt-bindings/leds/common.h>
#include <dt-bindings/regulator/richtek,rt5190a-regulator.h>

/ {
	model = "Bananapi BPI-R4";
	compatible = "bananapi,bpi-r4",
		     "mediatek,mt7988a";

	/* SFP2 cage (LAN) */
	sfp2: sfp2 {
		compatible = "sff,sfp";
		i2c-bus = <&i2c_sfp2>;
		los-gpios = <&pio 2 GPIO_ACTIVE_HIGH>;
		mod-def0-gpios = <&pio 83 GPIO_ACTIVE_LOW>;
		tx-disable-gpios = <&pio 0 GPIO_ACTIVE_HIGH>;
		tx-fault-gpios = <&pio 1 GPIO_ACTIVE_HIGH>;
		rate-select0-gpios = <&pio 3 GPIO_ACTIVE_LOW>;
		maximum-power-milliwatt = <3000>;
	};
};

&gmac1 {
	sfp = <&sfp2>;
	managed = "in-band-status";
	phy-mode = "usxgmii";
	status = "okay";
};

&pca9545 {
	i2c_sfp2: i2c@2 {
		#address-cells = <1>;
		#size-cells = <0>;
		reg = <2>;
	};
};

&ssusb0 {
	status = "okay";
};

&ssusb1 {
	status = "okay";
};

&tphy {
	status = "okay";
};

&spi0 {
	pinctrl-names = "default";
	pinctrl-0 = <&spi0_flash_pins>;
	status = "okay";

	spi_nand: spi_nand@0 {
		compatible = "spi-nand";
		reg = <0>;
		spi-max-frequency = <52000000>;
		spi-tx-buswidth = <4>;
		spi-rx-buswidth = <4>;
	};
};

&spi_nand {
  partitions {
		compatible = "fixed-partitions";
		#address-cells = <1>;
		#size-cells = <1>;

		partition@0 {
			label = "BL2";
			reg = <0x00000 0x0100000>;
			read-only;
		};

		partition@100000 {
			label = "u-boot-env";
			reg = <0x100000 0x0080000>;
			read-only; /* Protecting your environment variables */
		};

		partition@180000 {
			label = "Factory";
			reg = <0x180000 0x0400000>;
			read-only; /* Calibration data - CRITICAL to keep RO */
		};

		partition@580000 {
			label = "FIP";
			reg = <0x580000 0x0200000>;
			read-only;
		};

		partition@780000 {
			label = "ubi";
			reg = <0x780000 0x7880000>;
			/* No ubi compatibility string here prevents auto-attach */
			read-only; 
		};
	};
};

&uart0 {
	status = "okay";
};

&mmc0 {
	pinctrl-names = "default", "state_uhs";
	pinctrl-0 = <&mmc0_pins_sdcard>;
	pinctrl-1 = <&mmc0_pins_sdcard>;
	cd-gpios = <&pio 12 GPIO_ACTIVE_LOW>;
	bus-width = <4>;
	max-frequency = <52000000>;
	cap-sd-highspeed;
	vmmc-supply = <&reg_3p3v>;
	vqmmc-supply = <&reg_3p3v>;
	no-mmc;
	#address-cells = <1>;
	#size-cells = <0>;
	status = "okay";
};
